WITH inst AS (
  SELECT
    SNAPSHOT_ID,
    COALESCE(CREATE_TIME, START_TIME) AS ts
  FROM LSW_BPD_INSTANCE
)
SELECT
  p.PROJECT_NAME          AS process_app,
  s.SNAPSHOT_NAME         AS snapshot,
  SUM(CASE WHEN inst.ts >= (CURRENT_TIMESTAMP - 3 MONTHS) THEN 1 ELSE 0 END) AS last_3_months_count,
  SUM(CASE WHEN inst.ts >= (CURRENT_TIMESTAMP - 6 MONTHS) THEN 1 ELSE 0 END) AS last_6_months_count
FROM LSW_PROJECT  p
JOIN LSW_SNAPSHOT s  ON s.PROJECT_ID  = p.PROJECT_ID
LEFT JOIN inst       ON inst.SNAPSHOT_ID = s.SNAPSHOT_ID
GROUP BY p.PROJECT_NAME, s.SNAPSHOT_NAME
ORDER BY p.PROJECT_NAME, s.SNAPSHOT_NAME;

WITH inst AS (
  SELECT
    SNAPSHOT_ID,
    CREATE_DATETIME AS ts
  FROM LSW_BPD_INSTANCE
)
SELECT
  p.PROJECT_NAME   AS process_app,
  s.SNAPSHOT_NAME  AS snapshot,
  SUM(CASE WHEN inst.ts >= (CURRENT_TIMESTAMP - 3 MONTHS) THEN 1 ELSE 0 END) AS last_3_months_count,
  SUM(CASE WHEN inst.ts >= (CURRENT_TIMESTAMP - 6 MONTHS) THEN 1 ELSE 0 END) AS last_6_months_count
FROM LSW_PROJECT  p
JOIN LSW_SNAPSHOT s ON s.PROJECT_ID = p.PROJECT_ID
LEFT JOIN inst      ON inst.SNAPSHOT_ID = s.SNAPSHOT_ID
GROUP BY p.PROJECT_NAME, s.SNAPSHOT_NAME
ORDER BY p.PROJECT_NAME, s.SNAPSHOT_NAME;
