- name: Load certificate info for 1.crt
  community.crypto.x509_certificate_info:
    path: "/path/to/1.crt"
  register: cert_info
  delegate_to: localhost

- name: Parse certificate expiration into datetime
  set_fact:
    expiry_date: "{{ cert_info.not_after | to_datetime('%Y%m%d%H%M%SZ') }}"
# cert_info.not_after yields an ASN.1 TIME string like '20250701120000Z' :contentReference[oaicite:4]{index=4} :contentReference[oaicite:5]{index=5}

- name: Parse current time into datetime
  set_fact:
    current_date: "{{ ansible_date_time.iso8601 | to_datetime('%Y-%m-%dT%H:%M:%SZ') }}"
# ansible_date_time.iso8601 provides current ISO8601 timestamp :contentReference[oaicite:6]{index=6}

- name: Compute days until expiry
  set_fact:
    expiry_days: "{{ (expiry_date - current_date).days }}"
# Subtracting two datetimes produces a timedelta; .days gives the whole days difference :contentReference[oaicite:7]{index=7}

- name: Show result
  debug:
    msg: "1.crt expires in {{ expiry_days }} days."
