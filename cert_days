- name: Get expiry timestamp in seconds since epoch
  shell: |
    date --date="$(openssl x509 -enddate -noout -in /path/to/1.crt | cut -d= -f2)" +%s
  register: expiry_ts_raw
  changed_when: false

- name: Convert expiry timestamp to integer
  set_fact:
    expiry_ts: "{{ expiry_ts_raw.stdout | int }}"

- name: Get current epoch from Ansible facts
  set_fact:
    now_ts: "{{ ansible_date_time.epoch | int }}"

- name: Calculate days remaining via epoch arithmetic
  set_fact:
    expiry_days_epoch: "{{ (expiry_ts - now_ts) // 86400 }}"
