- name: Get certificate expiry string for 1.crt
  shell: openssl x509 -enddate -noout -in /path/to/1.crt | cut -d= -f2
  register: end_date_raw
  changed_when: false

- name: Parse expiry date into a datetime object
  set_fact:
    expiry_date: >-
      {{ end_date_raw.stdout
         | ansible.builtin.to_datetime('%b %e %H:%M:%S %Y %Z') }}
- name: Parse current time into a datetime object
  set_fact:
    current_date: >-
      {{ ansible_date_time.iso8601
         | ansible.builtin.to_datetime('%Y-%m-%dT%H:%M:%SZ') }}

- name: Compute days until certificate expires
  set_fact:
    expiry_days: "{{ (expiry_date - current_date).days }}"

- name: Show days remaining until expiry
  debug:
    msg: "Certificate '1.crt' expires in {{ expiry_days }} days."
