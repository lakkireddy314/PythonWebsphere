---
# roles/your_role_name/tasks/backup.yml

- name: Ensure backup directory exists
  file:
    path: "/home/{{ was_user }}/Ansible_backup"
    state: directory
    owner: "{{ was_user }}"
    group: "{{ was_user }}"
    mode: '0755'

- name: Stat IHS config files
  stat:
    path: "{{ conf_file }}"
  loop:
    - "{{ IHS_install_root }}/conf/bpm-httpd.conf"
    - "{{ IHS_install_root }}/conf/admin.conf"
  loop_control:
    loop_var: conf_file
  register: ihs_conf_files

- name: Backup IHS config files
  copy:
    src: "{{ file_entry.conf_file }}"
    dest: "/home/{{ was_user }}/Ansible_backup/{{ file_entry.conf_file | basename }}"
    remote_src: yes
  loop: "{{ ihs_conf_files.results }}"
  loop_control:
    loop_var: file_entry
  when: file_entry.stat.exists

- name: Stat IHS htdocs directory
  stat:
    path: "{{ htdocs_dir }}"
  vars:
    htdocs_dir: "{{ IHS_install_root }}/htdocs"
  register: htdocs_entry

- name: Backup IHS htdocs directory
  copy:
    src: "{{ htdocs_dir }}/"
    dest: "/home/{{ was_user }}/Ansible_backup/htdocs/"
    remote_src: yes
    recursive: yes
  when: htdocs_entry.stat.isdir

- name: Stat Plugins config directory
  stat:
    path: "{{ plugins_dir }}"
  vars:
    plugins_dir: "{{ Plugins_install_root }}/config"
  register: plugins_entry

- name: Backup Plugins config directory
  copy:
    src: "{{ plugins_dir }}/"
    dest: "/home/{{ was_user }}/Ansible_backup/config/"
    remote_src: yes
    recursive: yes
  when: plugins_entry.stat.isdir
