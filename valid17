# listAppServerHttps.py
# Jython wsadmin script to print host and HTTPS port for all application servers

# 1. Get all Node objects
nodes = AdminConfig.list('Node').splitlines()

for node in nodes:
    nodeName = AdminConfig.showAttribute(node, 'name') 

    # 2. List all ServerEntry objects under this node
    serverEntries = AdminConfig.list('ServerEntry', node).splitlines()

    for server in serverEntries:
        # 3. Find the secure endpoint
        for ep in AdminConfig.list('EndPoint', server).splitlines():  # list ports under the server 
            if AdminConfig.showAttribute(ep, 'endPointName') == 'WC_defaulthost_secure':
                host = AdminConfig.showAttribute(ep, 'host')
                port = AdminConfig.showAttribute(ep, 'port')

                # 4. If host is wildcard, get actual hostName from runtime MBean
                if host == '*':
                    objName = AdminControl.completeObjectName(
                        'WebSphere:type=Server,name=%s,node=%s,*' % ( 
                            AdminConfig.showAttribute(server, 'serverName'), nodeName
                        )
                    )
                    host = AdminControl.getAttribute(objName, 'hostName')

                # 5. Print result
                print "%s|%s" % (host, port)
