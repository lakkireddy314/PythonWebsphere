# listHttpsHosts_fixed.py
# jython wsadmin script: print host|httpsPort for all app servers

nodes = AdminConfig.list('Node').splitlines()
for node in nodes:
    if not node.strip(): continue
    nodeName = AdminConfig.showAttribute(node, 'name')
    for server in AdminConfig.list('ServerEntry', node).splitlines():
        if not server.strip(): continue
        for ep in AdminConfig.list('EndPoint', server).splitlines():
            if AdminConfig.showAttribute(ep, 'endPointName') != 'WC_defaulthost_secure':
                continue
            host = AdminConfig.showAttribute(ep, 'host')
            port = AdminConfig.showAttribute(ep, 'port')
            if host == '*':
                srvName = AdminConfig.showAttribute(server, 'serverName')
                obj = AdminControl.completeObjectName(
                    'WebSphere:type=Server,name=%s,node=%s,*' % (srvName, nodeName)
                )
                host = AdminControl.getAttribute(obj, 'hostName')
            print "%s|%s" % (host, port)
