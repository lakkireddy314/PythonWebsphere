# getHttpsPorts.py
# Jython wsadmin script to list HTTPS port and host for all application servers

# Retrieve all ServerEntry config objects
serverEntries = AdminConfig.list('ServerEntry').splitlines()

for server in serverEntries:
    serverName = AdminConfig.showAttribute(server, 'serverName')
    nodeName   = AdminConfig.showAttribute(server, 'nodeName')
    
    # List all endpoint children under this server
    endpoints = AdminConfig.list('EndPoint', server).splitlines()
    for ep in endpoints:
        epName = AdminConfig.showAttribute(ep, 'endPointName')
        # Filter for the secure HTTPS endpoint
        if epName == 'WC_defaulthost_secure':
            host = AdminConfig.showAttribute(ep, 'host')
            port = AdminConfig.showAttribute(ep, 'port')
            
            # If configured host is wildcard, fetch actual host from runtime MBean
            if host == '*':
                objName = AdminControl.completeObjectName(
                    'WebSphere:type=Server,name=%s,node=%s,*' % (serverName, nodeName)
                )
                host = AdminControl.getAttribute(objName, 'hostName')
            
            # Output in CSV-friendly format
            print "%s|%s|%s|%s" % (serverName, nodeName, host, port)
