# getSecurePorts_entry_withHost.py
# Usage:
#   wsadmin.sh -lang jython -f getSecurePorts_entry_withHost.py \
#       -conntype SOAP -host <dmgrHost> -port <dmgrPort>

import java

# Java line separator
sep = java.lang.System.getProperty('line.separator')

# 1. Get the cell name
cellId   = AdminConfig.list('Cell').splitlines()[0]
cellName = cellId.split('(')[0]

# 2. Iterate all ServerEntry objects
for srvEntry in AdminConfig.list('ServerEntry').splitlines():
    srvName = srvEntry.split('(', 1)[0]
    nodeName = AdminConfig.showAttribute(srvEntry, 'nodeName')

    # 3. Iterate each NamedEndPoint under ServerEntry
    for nep in AdminConfig.list('NamedEndPoint', srvEntry).split(sep):
        if not nep.strip():
            continue
        name = AdminConfig.showAttribute(nep, 'endPointName')
        if name == 'WC_defaulthost_secure':
            # Retrieve nested EndPoint to get both host & port
            epRef = AdminConfig.showAttribute(nep, 'endPoint')
            host  = AdminConfig.showAttribute(epRef, 'host')
            port  = AdminConfig.showAttribute(epRef, 'port')
            print "%s %s %s %s %s" % (
                cellName, nodeName, srvName, host, port)
