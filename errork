In process_webserver_backup.yml
Replace the removal task with:

yaml
Copy
- name: Set remove_count for WebServer backups for {{ ws_src | basename }}
  set_fact:
    remove_count: "{{ (ws_existing_backups.files | default([]) | length | int) - (backup_retain | int) }}"
  when: ws_source_stat.stat.exists

- name: Remove old WebServer backups for {{ ws_src | basename }} (retain {{ backup_retain }})
  file:
    path: "{{ item.path }}"
    state: absent
  loop: >
    {{
      (ws_existing_backups.files | sort(attribute='mtime') | list)
      [:remove_count] if (remove_count | int) > 0 else []
    }}
  loop_control:
    loop_var: item
  when: ws_source_stat.stat.exists and ((ws_existing_backups.files | default([]) | length | int) > (backup_retain | int))
In process_websphere_backup.yml
Replace the removal task with:

yaml
Copy
- name: Set remove_count for WebSphere backups for {{ wsphere_src | basename }}
  set_fact:
    remove_count: "{{ (wsphere_existing_backups.files | default([]) | length | int) - (backup_retain | int) }}"
  when: wsphere_source_stat.stat.exists

- name: Remove old WebSphere backups for {{ wsphere_src | basename }} (retain {{ backup_retain }})
  file:
    path: "{{ item.path }}"
    state: absent
  loop: >
    {{
      (wsphere_existing_backups.files | sort(attribute='mtime') | list)
      [:remove_count] if (remove_count | int) > 0 else []
    }}
  loop_control:
    loop_var: item
  when: wsphere_source_stat.stat.exists and ((wsphere_existing_backups.files | default([]) | length | int) > (backup_retain | int))
Explanation & Features
Separate Calculation with set_fact:
We compute remove_count as the number of backup files minus backup_retain, ensuring both values are cast to integers.

Conditional Slicing with Python Slicing Syntax:
The loop uses a Jinja2 expression:

jinja
Copy
(ws_existing_backups.files | sort(attribute='mtime') | list)[:remove_count] if (remove_count | int) > 0 else []
This means:

If remove_count is greater than zero, we slice the sorted list to get that many items.
Otherwise, we use an empty list, so the loop never runs.
When Conditions:
The task runs only if the source directory exists and if the number of backup files exceeds the retention count.

Using this approach should prevent the ZeroDivisionError and allow the role to remove old backups as intended.
