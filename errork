Below is an updated version of the removal task in both the WebServer and WebSphere backup files. In this version, we add a default value for the list of files and explicitly calculate the number of files to remove. This ensures that the expression never attempts an integer division or modulo by zero.

For example, in process_webserver_backup.yml, replace the removal task with:

yaml
Copy
- name: Remove old WebServer backups for {{ ws_src | basename }} (retain {{ backup_retain }})
  file:
    path: "{{ item.path }}"
    state: absent
  loop: >-
    {{
      (ws_existing_backups.files | default([]) 
      | sort(attribute='mtime') 
      | list)
      | slice(0, ((ws_existing_backups.files | default([]) | length) - backup_retain) | int)
    }}
  loop_control:
    loop_var: item
  when: ws_source_stat.stat.exists and ((ws_existing_backups.files | default([]) | length) > backup_retain)
And similarly in process_websphere_backup.yml:

yaml
Copy
- name: Remove old WebSphere backups for {{ wsphere_src | basename }} (retain {{ backup_retain }})
  file:
    path: "{{ item.path }}"
    state: absent
  loop: >-
    {{
      (wsphere_existing_backups.files | default([]) 
      | sort(attribute='mtime') 
      | list)
      | slice(0, ((wsphere_existing_backups.files | default([]) | length) - backup_retain) | int)
    }}
  loop_control:
    loop_var: item
  when: wsphere_source_stat.stat.exists and ((wsphere_existing_backups.files | default([]) | length) > backup_retain)
Explanation & Features
Using default([]) on Files List:
We now use | default([]) when accessing ws_existing_backups.files (and similarly for WebSphere). This ensures that if no files are found, the expression defaults to an empty list instead of None.

Explicit Calculation for Slice End:
We calculate the number of items to remove as:

csharp
Copy
(ws_existing_backups.files | default([]) | length) - backup_retain
and cast that result to an integer. If the number of backup files is less than or equal to backup_retain, the condition in when: prevents the task from running.

Prevents ZeroDivisionError:
By using the default value and ensuring the slice is only performed when the number of backups is greater than backup_retain, we avoid any situation where a division or modulo by zero might occur.

Apply the same changes in both backup processing files (for WebServer and WebSphere), and this should resolve the error.
