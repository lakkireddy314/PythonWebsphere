# getHostAndPorts.py
# Retrieves hostname and HTTPS port for all application servers
# Fixes the “string member test needs char left operand” error
# by using find() on a Python str()

# List all ServerEntry configuration objects
serverEntries = AdminConfig.list('ServerEntry').splitlines()

for serverEntry in serverEntries:
    # Parse out server and node names
    serverName = serverEntry.split('(')[0]
    nodeName   = serverEntry.split('/nodes/')[1].split('/')[0]
    
    # List all NamedEndPoint objects under this server entry
    namedEndpoints = AdminConfig.list('NamedEndPoint', serverEntry).splitlines()
    
    for ne in namedEndpoints:
        # epName is a Java String; cast to Python str for safe methods
        epName = str(AdminConfig.showAttribute(ne, 'endPointName'))
        # look for “secure” (case-insensitive) via find()
        if epName.lower().find('secure') != -1:
            # epRef is the config ID of the actual endpoint object
            epRef = AdminConfig.showAttribute(ne, 'endPoint')
            # Now retrieve host and port attributes
            host = AdminConfig.showAttribute(epRef, 'host')
            port = AdminConfig.showAttribute(epRef, 'port')
            
            print "Node: %s, Server: %s, Host: %s, Endpoint: %s, Port: %s" % (
                nodeName, serverName, host, epName, port
            )
