# getHostAndPorts.py
# Retrieves actual hostname and HTTPS port for all application servers

# 1. List all ServerEntry configuration objects
serverEntries = AdminConfig.list('ServerEntry').splitlines()

for serverEntry in serverEntries:
    # 2. Parse server and node names
    serverName = serverEntry.split('(')[0]
    nodeName   = serverEntry.split('/nodes/')[1].split('/')[0]
    
    # 3. Get the Node config ID and actual hostName
    nodeId   = AdminConfig.getid('/Node:%s/' % nodeName)
    hostName = AdminConfig.showAttribute(nodeId, 'hostName')
    
    # 4. List NamedEndPoint objects under this server
    namedEndpoints = AdminConfig.list('NamedEndPoint', serverEntry).splitlines()
    for ne in namedEndpoints:
        epName = str(AdminConfig.showAttribute(ne, 'endPointName'))
        # 5. Filter for secure (HTTPS) endpoints
        if epName.lower().find('secure') != -1:
            # 6. Retrieve port from the endpoint reference
            epRef = AdminConfig.showAttribute(ne, 'endPoint')
            port  = AdminConfig.showAttribute(epRef, 'port')
            
            # 7. Output Node, Server, actual host, endpoint, and port
            print "Node: %s, Server: %s, Host: %s, Endpoint: %s, Port: %s" % (
                nodeName, serverName, hostName, epName, port
            )
